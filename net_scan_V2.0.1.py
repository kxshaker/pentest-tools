#!/usr/bin/env python
import scapy.all as scapy
import argparse


def scan(ip):
    broadcast = scapy.Ether(dst="FF:FF:FF:FF:FF:FF")
    arp_req   = scapy.ARP(pdst=ip)
    broadcast_arp_req = broadcast/arp_req
    answered  = scapy.srp(broadcast_arp_req, timeout=2, retry=1, verbose=0)[0]
    host_list = []
    for host in answered:
        record = {"ip":host[1].psrc,"mac":host[1].hwsrc}
        host_list.append(record)
    return host_list

def get_arguments():
    parser = argparse.ArgumentParser()
    parser.add_argument("-r","-range", dest="iprange", help="Enter IP range with / prefix")
    args = parser.parse_args()
    return args.iprange

def print_scan(target):
    print("IP\t\t\tMAC address\n------------------------------------------")
    for entry in target:
        print(entry["ip"]+"\t\t"+entry["mac"])

print_scan(scan(get_arguments()))