#!/usr/bin/env python
import scapy.all as scapy
import optparse

def scan(ip):
    arp_request   = scapy.ARP(pdst=ip)
    broadcast     = scapy.Ether(dst="FF:FF:FF:FF:FF:FF")
    arp_broadcast = broadcast/arp_request
    answer_list, no_answer_list = scapy.srp(arp_broadcast,retry=1 , verbose=False,timeout=2)
    hosts_answered = []
    for host in answer_list:
        host_dictionary = {"ip":host[1].psrc,"mac":host[1].hwsrc}
        hosts_answered.append(host_dictionary)
    return hosts_answered

def print_result(host_list):
    print("IP\t\t\tMAC address\n-----------------------------------")
    for host in host_list:
        print(host["ip"]+"\t\t"+host["mac"])

def get_options():
    parser = optparse.OptionParser()
    parser.add_option("-t", "--target", dest="ip", help="Enter IP address range eg: 192.168.1.1/24 or a single ip address eg: 192.168.1.10")
    options = parser.parse_args()[0]
    if not options.ip:
        parser.error("[-] Please enter a valid IP address or address range use -h for help")
    return options


print_result(scan(get_options().ip))

# print(answer_list.show())
# print(arp_broadcast.show())

